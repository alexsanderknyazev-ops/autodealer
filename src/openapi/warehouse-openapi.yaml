openapi: 3.0.0
info:
  title: AutoDealer Warehouse API
  description: Microservice for warehouse management in automotive dealership
  version: 1.0.0
  contact:
    name: API Support
    email: support@autodealer.com

servers:
  - url: http://localhost:8080
    description: Development server

paths:
  /api/warehouse:
    get:
      summary: Get all warehouse items
      description: Retrieve all items from warehouse with part information
      operationId: getWarehouseItems
      tags:
        - Warehouse
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/WarehouseItemWithPart'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    post:
      summary: Create new warehouse item
      description: Add new item to warehouse inventory
      operationId: createWarehouseItem
      tags:
        - Warehouse
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateWarehouseItemRequest'
      responses:
        '201':
          description: Warehouse item created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WarehouseItem'
        '400':
          description: Validation failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
        '409':
          description: Warehouse item for this part already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/warehouse/low-stock:
    get:
      summary: Get low stock items
      description: Retrieve warehouse items with quantity below minimum stock level
      operationId: getLowStockItems
      tags:
        - Warehouse
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/WarehouseItemWithPart'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/warehouse/total-value:
    get:
      summary: Get total inventory value
      description: Calculate total value of all inventory items
      operationId: getTotalInventoryValue
      tags:
        - Warehouse
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                type: object
                properties:
                  total_value:
                    type: number
                    format: double
                    example: 150000.50
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/warehouse/{id}:
    get:
      summary: Get warehouse item by ID
      description: Retrieve specific warehouse item by its ID
      operationId: getWarehouseItemById
      tags:
        - Warehouse
      parameters:
        - name: id
          in: path
          required: true
          description: Warehouse item UUID
          schema:
            type: string
            format: uuid
            example: "123e4567-e89b-12d3-a456-426614174000"
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WarehouseItemWithPart'
        '404':
          description: Warehouse item not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    put:
      summary: Update warehouse item
      description: Update existing warehouse item information
      operationId: updateWarehouseItem
      tags:
        - Warehouse
      parameters:
        - name: id
          in: path
          required: true
          description: Warehouse item UUID
          schema:
            type: string
            format: uuid
            example: "123e4567-e89b-12d3-a456-426614174000"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateWarehouseItemRequest'
      responses:
        '200':
          description: Warehouse item updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WarehouseItem'
        '400':
          description: Validation failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
        '404':
          description: Warehouse item not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      summary: Delete warehouse item
      description: Remove warehouse item from inventory
      operationId: deleteWarehouseItem
      tags:
        - Warehouse
      parameters:
        - name: id
          in: path
          required: true
          description: Warehouse item UUID
          schema:
            type: string
            format: uuid
            example: "123e4567-e89b-12d3-a456-426614174000"
      responses:
        '204':
          description: Warehouse item deleted successfully
        '404':
          description: Warehouse item not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/warehouse/part/{part_id}:
    get:
      summary: Get warehouse item by part ID
      description: Retrieve warehouse item using part identifier
      operationId: getWarehouseItemByPartId
      tags:
        - Warehouse
      parameters:
        - name: part_id
          in: path
          required: true
          description: Part UUID
          schema:
            type: string
            format: uuid
            example: "11111111-1111-1111-1111-111111111111"
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WarehouseItem'
        '404':
          description: Warehouse item not found for this part
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/warehouse/article/{article}:
    get:
      summary: Get warehouse item by article
      description: Retrieve warehouse item using part article number
      operationId: getWarehouseItemByArticle
      tags:
        - Warehouse
      parameters:
        - name: article
          in: path
          required: true
          description: Part article number
          schema:
            type: string
            example: "ENG-OIL-001"
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WarehouseItemWithPart'
        '404':
          description: Warehouse item not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/warehouse/location/{location}:
    get:
      summary: Get warehouse items by location
      description: Search warehouse items by storage location
      operationId: getWarehouseItemsByLocation
      tags:
        - Warehouse
      parameters:
        - name: location
          in: path
          required: true
          description: Storage location (supports partial match)
          schema:
            type: string
            example: "A1"
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/WarehouseItemWithPart'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/warehouse/{part_id}/stock:
    put:
      summary: Update stock quantity
      description: Update stock with incoming, outgoing or adjustment movement
      operationId: updateStock
      tags:
        - Warehouse
      parameters:
        - name: part_id
          in: path
          required: true
          description: Part UUID
          schema:
            type: string
            format: uuid
            example: "11111111-1111-1111-1111-111111111111"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StockMovementRequest'
      responses:
        '200':
          description: Stock updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WarehouseItem'
        '400':
          description: Validation failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
        '404':
          description: Warehouse item not found or insufficient stock
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  schemas:
    WarehouseItem:
      type: object
      required:
        - id
        - part_id
        - quantity
        - min_stock_level
        - max_stock_level
        - created_at
        - updated_at
      properties:
        id:
          type: string
          format: uuid
          description: Unique identifier for warehouse item
          example: "123e4567-e89b-12d3-a456-426614174000"
        part_id:
          type: string
          format: uuid
          description: Reference to part
          example: "11111111-1111-1111-1111-111111111111"
        quantity:
          type: integer
          minimum: 0
          description: Current stock quantity
          example: 50
        min_stock_level:
          type: integer
          minimum: 0
          description: Minimum stock level for alerts
          example: 10
        max_stock_level:
          type: integer
          minimum: 0
          description: Maximum stock capacity
          example: 100
        location:
          type: string
          nullable: true
          description: Storage location in warehouse
          example: "A1-01"
        created_at:
          type: string
          format: date-time
          description: Creation timestamp
          example: "2023-10-01T12:00:00Z"
        updated_at:
          type: string
          format: date-time
          description: Last update timestamp
          example: "2023-10-01T12:00:00Z"

    WarehouseItemWithPart:
      type: object
      required:
        - id
        - part_id
        - part_article
        - part_name
        - quantity
        - min_stock_level
        - max_stock_level
        - created_at
        - updated_at
      properties:
        id:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174000"
        part_id:
          type: string
          format: uuid
          example: "11111111-1111-1111-1111-111111111111"
        part_article:
          type: string
          description: Part article number
          example: "ENG-OIL-001"
        part_name:
          type: string
          description: Part name
          example: "Масло моторное синтетическое 5W-30"
        quantity:
          type: integer
          minimum: 0
          example: 50
        min_stock_level:
          type: integer
          minimum: 0
          example: 10
        max_stock_level:
          type: integer
          minimum: 0
          example: 100
        location:
          type: string
          nullable: true
          example: "A1-01"
        created_at:
          type: string
          format: date-time
          example: "2023-10-01T12:00:00Z"
        updated_at:
          type: string
          format: date-time
          example: "2023-10-01T12:00:00Z"

    CreateWarehouseItemRequest:
      type: object
      required:
        - part_id
        - quantity
      properties:
        part_id:
          type: string
          format: uuid
          description: Reference to part
          example: "11111111-1111-1111-1111-111111111111"
        quantity:
          type: integer
          minimum: 0
          description: Initial stock quantity
          example: 50
        min_stock_level:
          type: integer
          minimum: 0
          description: Minimum stock level
          example: 10
        max_stock_level:
          type: integer
          minimum: 0
          description: Maximum stock level
          example: 100
        location:
          type: string
          nullable: true
          description: Storage location
          example: "A1-01"

    UpdateWarehouseItemRequest:
      type: object
      properties:
        quantity:
          type: integer
          minimum: 0
          description: Stock quantity
          example: 75
        min_stock_level:
          type: integer
          minimum: 0
          description: Minimum stock level
          example: 15
        max_stock_level:
          type: integer
          minimum: 0
          description: Maximum stock level
          example: 120
        location:
          type: string
          nullable: true
          description: Storage location
          example: "A1-02"

    StockMovementRequest:
      type: object
      required:
        - quantity
        - movement_type
      properties:
        quantity:
          type: integer
          minimum: 1
          description: Quantity to move
          example: 25
        movement_type:
          type: string
          enum: [incoming, outgoing, adjustment]
          description: Type of stock movement
          example: "incoming"

    ErrorResponse:
      type: object
      properties:
        error:
          type: string
          description: Error message
          example: "Warehouse item not found"

    ValidationError:
      type: object
      properties:
        error:
          type: string
          example: "Validation failed"
        details:
          type: object
          description: Validation error details
          additionalProperties:
            type: array
            items:
              type: string

  parameters:
    WarehouseItemId:
      name: id
      in: path
      required: true
      description: Warehouse item UUID
      schema:
        type: string
        format: uuid

    PartId:
      name: part_id
      in: path
      required: true
      description: Part UUID
      schema:
        type: string
        format: uuid

    Article:
      name: article
      in: path
      required: true
      description: Part article number
      schema:
        type: string

    Location:
      name: location
      in: path
      required: true
      description: Storage location
      schema:
        type: string

  responses:
    NotFound:
      description: The specified resource was not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    ValidationError:
      description: Validation failed
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ValidationError'

    InternalError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    Conflict:
      description: Resource already exists
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

tags:
  - name: Warehouse
    description: Warehouse inventory management operations